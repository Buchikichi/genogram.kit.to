var $jscomp={scope:{},getGlobal:function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a}};$jscomp.global=$jscomp.getGlobal(this);$jscomp.inherits=function(a,b){function c(){}c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a;for(var d in b)if(Object.defineProperties){var e=Object.getOwnPropertyDescriptor(b,d);e&&Object.defineProperty(a,d,e)}else a[d]=b[d]};
var People=function(a){a=void 0===a?null:a;this.id=null==a?UUID.toString():a;this.dob=this.gender=this.description=this.name="";this.motherId=null;this.partnerList=[];this.childrenList=[]},Actor=function(a){People.call(this,void 0===a?null:a);this.y=this.x=0;this.radius=32};$jscomp.inherits(Actor,People);
Actor.prototype.scanAll=function(a){var b=this,c=Field.Instance.spacing,d=this.x,e=this.partnerList.length,f=this.x-(this.childrenList.length-1)*c/2,g=this.y;a.push(this);this.partnerList.forEach(function(e){d+=c;e.x=d;e.y=b.y;-1==a.indexOf(e)&&e.scanAll(a)});0<e&&(f+=c/2);this.childrenList.forEach(function(b){b.x=f;b.y=g+c;f+=c;-1==a.indexOf(b)&&b.scanAll(a)})};Actor.prototype.addPartner=function(a){(a=void 0===a?null:a)?this.partnerList.push(a):this.partnerList.push(new Actor)};
Actor.prototype.addChild=function(a){(a=void 0===a?null:a)?this.childrenList.push(a):this.childrenList.push(new Actor)};Actor.prototype.isHit=function(a,b){a=this.x-a;b=this.y-b;return this.hit=Math.sqrt(a*a+b*b)<this.radius};Actor.prototype.drawSymbol=function(a){a.lineWidth=this.hit?5:2;a.strokeStyle=this.strokeStyle;if("m"==this.gender){var b=2*this.radius;a.strokeRect(-this.radius,-this.radius,b,b)}else a.beginPath(),a.arc(0,0,this.radius,0,2*Math.PI,!1),a.stroke()};
Actor.prototype.drawName=function(a){var b=this.name,c=-a.measureText(b).width/2,d=0+this.radius;a.lineWidth=1;a.beginPath();a.strokeStyle="black";a.strokeText(b,c,d)};Actor.prototype.drawPartnerLine=function(a){var b=this;this.partnerList.forEach(function(c){var d=c.left-b.x;c=c.y-b.y;a.beginPath();a.moveTo(b.right,0);a.lineTo(d,c);a.stroke()})};
Actor.prototype.drawChildLine=function(a){var b=this;if(0!=this.childrenList.length){var c=Field.Instance.spacing/2,d=this.y+c,e;0==this.partnerList.length?(e=this.x,c=this.bottom):(e=this.x+c,c=this.y);a.beginPath();a.moveTo(e,c);a.lineTo(e,d);a.stroke();var f=!0,g=null;this.childrenList.forEach(function(c){var h=c.x-b.x,k=c.top-b.y;a.beginPath();f&&(a.moveTo(e,d),a.lineTo(h,d),f=!1);a.moveTo(h,d);a.lineTo(h,k);a.stroke();g=c});a.beginPath();a.moveTo(e,d);a.lineTo(g.x-this.x,d);a.stroke()}};
Actor.prototype.drawLine=function(a){this.drawPartnerLine(a);this.drawChildLine(a)};Actor.prototype.draw=function(a){this.strokeStyle=this.hit?"white":"black";a.save();a.translate(this.x,this.y);this.drawLine(a);this.drawSymbol(a);this.drawName(a);a.restore()};
$jscomp.global.Object.defineProperties(Actor.prototype,{left:{configurable:!0,enumerable:!0,get:function(){return this.x-this.radius}},right:{configurable:!0,enumerable:!0,get:function(){return this.x+this.radius}},top:{configurable:!0,enumerable:!0,get:function(){return this.y-this.radius}},bottom:{configurable:!0,enumerable:!0,get:function(){return this.y+this.radius}}});
var Field=function(a,b){this.width=a;this.height=b;this.ty=this.tx=0;this.spacing=128;this.focus=null;this.actorList=[];this.setup();Field.Instance=this};Field.prototype.setup=function(){var a=document.getElementById("canvas");a.width=this.width;a.height=this.height;this.ctx=a.getContext("2d");this.resize()};
Field.prototype.resize=function(){var a=document.querySelector('[data-role="header"]').offsetHeight,b=document.body.clientWidth/this.width,a=(window.innerHeight-a)/this.height,c=document.getElementById("view");this.scale=a<b?a:b;c.setAttribute("style","transform: scale("+this.scale+");")};Field.prototype.scan=function(a,b){var c=this,d=a-this.tx,e=b-this.ty;this.target=null;this.actorList.forEach(function(a){a.isHit(d,e)&&(c.target=a)})};
Field.prototype.arrange=function(){var a=[];this.focus.scanAll(a);this.actorList=a;a.forEach(function(a){});this.tx=this.width/2;this.ty=this.height/2};Field.prototype.draw=function(){var a=this.ctx;a.clearRect(0,0,this.width,this.height);this.actorList.sort(function(a,c){return a.z-c.z});a.font="16px 'Times New Roman'";a.save();a.translate(this.tx,this.ty);this.actorList.forEach(function(b){b.draw(a)});a.restore()};
var InputPanel=function(){this.panel=document.getElementById("inputPanel");this.people=null;this.setupEvents()};
InputPanel.prototype.setupEvents=function(){var a=this,b=this.panel.querySelector('[name="name"]'),c=$('[name="gender"]'),d=document.getElementById("partnerButton"),e=document.getElementById("childButton");b.addEventListener("change",function(){a.people.name=b.value});c.click(function(b){a.people.gender=b.target.value;a.refreshControls()});d.addEventListener("click",function(){var b=a.people.gender,c=new Actor;c.gender="m"==b?"f":"f"==b?"m":"";a.people.addPartner(c)});$(d).addClass("ui-state-disabled");
e.addEventListener("click",function(){a.people.addChild()})};InputPanel.prototype.refreshControls=function(){var a=this.people.gender,b=this.people.partnerList.length,c=this.people.childrenList.length,d=document.getElementById("partnerButton"),e=document.getElementById("deleteButton");null==a||""==a?$(d).addClass("ui-state-disabled"):$(d).removeClass("ui-state-disabled");0<b||0<c?$(e).addClass("ui-state-disabled"):$(e).removeClass("ui-state-disabled")};
InputPanel.prototype.setupForm=function(){var a=this;$("#inputPanel form :input").each(function(b,c){b=c.getAttribute("name");var d=c.getAttribute("type"),e=a.people[b];"radio"==d?$(c).val([e]).checkboxradio("refresh"):(console.log(b+":"+e),$(c).val(e))});this.refreshControls()};InputPanel.prototype.open=function(a){this.people=a;this.setupForm();$(this.panel).panel("open")};var UUID=function(){};
UUID.toString=function(){return UUID.Format.replace(/X|Y/g,function(a){var b=16*Math.random()|0;return("X"===a?b:b&3|8).toString(16)})};UUID.Format="XXXXXXXX-XXXX-4XXX-YXXX-XXXXXXXXXXXX";document.addEventListener("DOMContentLoaded",function(){var a=new AppMain,b=function(){var c=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;a.draw();c(b)};b()});
var AppMain=function(){this.field=new Field(1024,768);this.inputPanel=new InputPanel;this.setupEvents();this.init()};AppMain.prototype.setupEvents=function(){var a=this,b=document.getElementById("view");b.addEventListener("mousemove",function(b){a.field.scan(b.layerX,b.layerY)});b.addEventListener("click",function(){var b=a.field.target;b&&a.inputPanel.open(b)});window.addEventListener("resize",function(){a.field.resize()})};AppMain.prototype.init=function(){this.field.focus=new Actor};
AppMain.prototype.draw=function(){this.field.arrange();this.field.draw()};
